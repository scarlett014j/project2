<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>

<script>

// set the dimensions and margins of the graph
var width = 460
var height = 460

// append the svg object to the body of the page
var svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(40,0)");  // bit of margin on the left = 40

// read json data
d3.json("../fakedata.json", function(data) {



  // Create the cluster layout:
  var cluster = d3.cluster()
    .size([height, width - 100]);  // 100 is the margin I will have on the right side

  // Give the data to this cluster layout:
  var root = d3.hierarchy(data, function(d) {
      return d.children;
  });
  cluster(root);


  // Add the links between nodes:
  svg.selectAll('path')
    .data( root.descendants().slice(1) )
    .enter()
    .append('path')
    .attr("d", function(d) {
        return "M" + d.y + "," + d.x
                + "C" + (d.parent.y + 50) + "," + d.x
                + " " + (d.parent.y + 150) + "," + d.parent.x // 50 and 150 are coordinates of inflexion, play with it to change links shape
                + " " + d.parent.y + "," + d.parent.x;
              })
    .style("fill", 'none')
    .attr("stroke", '#ccc')


  // Add a circle for each node.
  svg.selectAll("g")
      .data(root.descendants())
      .enter()
      .append("g")
      .attr("transform", function(d) {
          return "translate(" + d.y + "," + d.x + ")"
      })
      .append("circle")
        .attr("r", 7)
        .style("fill", "#69b3a2")
        .attr("stroke", "black")
        .style("stroke-width", 2)

})

</script>



// // from fileupload.models import FileAttachmentâ€©
// // var data = FileAttachment("flare-2.json").json();

// var data = Object {  name: "flare",
//   children: Array(10) [  0: Object {name: "analytics", children: Array(3)}
//   1: Object {name: "animate", children: Array(12)}
//   2: Object {name: "data", children: Array(7)}
//   3: Object {name: "display", children: Array(4)}
//   4: Object {name: "flex", children: Array(1)}
//   5: Object {name: "physics", children: Array(8)}
//   6: Object {name: "query", children: Array(29)}
//   7: Object {name: "scale", children: Array(10)}
//   8: Object {name: "util", children: Array(19)}
//   9: Object {name: "vis", children: Array(7)}
// ]
// };

// console.log(data);

// tree = data => {
//     const root = d3.hierarchy(data).sort((a, b) => d3.descending(a.height, b.height) || d3.ascending(a.data.name, b.data.name));
//     root.dx = 10;
    
//     root.dy = width / (root.height + 1);
//     return d3.cluster().nodeSize([root.dx, root.dy])(root);
// };

// console.log(data);


// var chart = {
//     const r = tree(data);
  
//     const svg = d3.create("svg");
  
//     svg.append("g")
//       .attr("fill", "none")
//       .attr("stroke", "#555")
//       .attr("stroke-opacity", 0.4)
//       .attr("stroke-width", 1.5)
//     .selectAll("path")
//       .data(r.links())
//       .join("path")
//         .attr("d", d => `
//           M${d.target.y},${d.target.x}
//           C${d.source.y + root.dy / 2},${d.target.x}
//            ${d.source.y + root.dy / 2},${d.source.x}
//            ${d.source.y},${d.source.x}
//         `);
  
//     svg.append("g")
//       .selectAll("circle")
//       .data(root.descendants())
//       .join("circle")
//         .attr("cx", d => d.y)
//         .attr("cy", d => d.x)
//         .attr("fill", d => d.children ? "#555" : "#999")
//         .attr("r", 2.5);
  
//     svg.append("g")
//         .attr("font-family", "sans-serif")
//         .attr("font-size", 10)
//         .attr("stroke-linejoin", "round")
//         .attr("stroke-width", 3)
//       .selectAll("text")
//       .data(root.descendants())
//       .join("text")
//         .attr("x", d => d.y)
//         .attr("y", d => d.x)
//         .attr("dy", "0.31em")
//         .attr("dx", d => d.children ? -6 : 6)
//         .text(d => d.data.name)
//       .filter(d => d.children)
//         .attr("text-anchor", "end")
//       .clone(true).lower()
//         .attr("stroke", "white");
  
//     return svg.attr("viewBox", autoBox).node();
// };

// function autoBox() {
//     document.body.appendChild(this);
//     const {x, y, width, height} = this.getBBox();
//     document.body.removeChild(this);
//     return [x, y, width, height];
// };


// d3 = require("d3@6");

